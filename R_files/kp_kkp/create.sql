CREATE TABLE IF NOT EXISTS kp_kkp (
  table_id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  hdr_id INT,
  komitmen_id INT,
  filter_26_wk BOOL,
  filter_38_wk BOOL,
  hdr_psc_id INT,
  holding_id INT,
  kontraktor VARCHAR(256),
  jenis_wk_id INT,
  tanggal_efektif DATE,
  area_id INT,
  basin_id INT,
  jenis_kegiatan_id INT,
  tipe_kegiatan_id INT,
  satuan INT,
  realisasi_satuan INT,
  anggaran_kks INT,
  realisasi_anggaran_kks INT,
  jumlah_kegiatan INT,
  realisasi_kegiatan INT,
  komitmen_tahun_ke INT,
  tahun_komitmen INT,
  tahun_pelaksanaan INT,
  ontime VARCHAR(64),
  akhir_periode_kp_kkp INT,
  status_pelaksanaan VARCHAR(64),
  jenis_unit_id INT,
  progress TEXT,
  catatan_khusus TEXT,
  nama_kegiatan TEXT,
  pengalihan_komitmen TEXT,
  bobot_penilaian_kinerja TEXT,

  CONSTRAINT fk_komitmen_id FOREIGN KEY (komitmen_id) REFERENCES jenis_komitmen (id),
  CONSTRAINT fk_hdr_psc_id FOREIGN KEY (hdr_psc_id) REFERENCES psc (id),
  CONSTRAINT fk_holding_id FOREIGN KEY (holding_id) REFERENCES holding (id),
  CONSTRAINT fk_jenis_wk_id FOREIGN KEY (jenis_wk_id) REFERENCES jenis_wk (id),
  CONSTRAINT fk_area_id FOREIGN KEY (area_id) REFERENCES area (id),
  CONSTRAINT fk_basin_id FOREIGN KEY (basin_id) REFERENCES basin (id),
  CONSTRAINT fk_jenis_kegiatan_id FOREIGN KEY (jenis_kegiatan_id) REFERENCES jenis_kegiatan (id),
  CONSTRAINT fk_tipe_kegiatan_id FOREIGN KEY (tipe_kegiatan_id) REFERENCES tipe_kegiatan (id),
  CONSTRAINT fk_jenis_unit_id FOREIGN KEY (jenis_unit_id) REFERENCES jenis_unit (id)
);

CREATE OR REPLACE FUNCTION insert_hdr_id_kp_kkp()
RETURNS TRIGGER AS $$
DECLARE
  res VARCHAR(32);
  cek_exists BOOL := false;
  new_hdr_id INT;
  exists_hdr_id INT;
BEGIN
  exists_hdr_id := (
    SELECT hdr_id FROM header WHERE
    komitmen_id = NEW.komitmen_id AND
    tipe_kegiatan_id = NEW.tipe_kegiatan_id AND
    jenis_kegiatan_id = NEW.jenis_kegiatan_id AND
    hdr_psc_id = NEW.hdr_psc_id
  );

  IF exists_hdr_id IS NOT NULL THEN
    new_hdr_id := (exists_hdr_id);
  ELSE
    INSERT INTO
      header (komitmen_id, tipe_kegiatan_id, create_by, jenis_kegiatan_id, hdr_psc_id, area_id, basin_id)
    VALUES
      (NEW.komitmen_id, NEW.tipe_kegiatan_id, 'MANUAL', NEW.jenis_kegiatan_id, NEW.hdr_psc_id, NEW.area_id, NEW.basin_id)
    RETURNING hdr_id INTO new_hdr_id;
  END IF;

  UPDATE kp_kkp
  SET hdr_id = new_hdr_id
  WHERE table_id = NEW.table_id;

  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER insert_hdr_id_on_kp_kkp_table
AFTER INSERT
ON kp_kkp
FOR EACH ROW
EXECUTE PROCEDURE insert_hdr_id_kp_kkp();

INSERT INTO
  kp_kkp (komitmen_id, filter_26_wk, filter_38_wk, hdr_psc_id, holding_id, kontraktor,                               jenis_wk_id,  tanggal_efektif, area_id, basin_id, jenis_kegiatan_id, tipe_kegiatan_id, satuan, realisasi_satuan, anggaran_kks, realisasi_anggaran_kks, jumlah_kegiatan, realisasi_kegiatan, komitmen_tahun_ke, tahun_komitmen,  tahun_pelaksanaan,    ontime,               akhir_periode_kp_kkp, status_pelaksanaan, jenis_unit_id,  progress,             catatan_khusus,     nama_kegiatan,                                                        pengalihan_komitmen,  bobot_penilaian_kinerja)
VALUES
  (2,           'Yes',        'Yes',        42,         17,         'PT PERTAMINA HULU ENERGI JAMBI MERANG',  367,          '2019-02-10',    0,       6,        109,               369,              30000,  30000,            30000000,     30000000,               1,               1,                  1,                 2019,            2019,                 'Terlaksana, mundur', 2027,                 'Sudah',            32,             'Selesai 2 Jun 2021', 'Amandemen ke IV',  'Akuisisi dan Processing Seismik 2D 32,215 km Area Bone-Tukang Besi', NULL,                 NULL),
  (2,           'Yes',        'Yes',        42,         17,         'PT PERTAMINA HULU ENERGI JAMBI MERANG',  367,          '2019-02-10',    0,       6,        59,               369,               1,  1,            5000000,     5000000,               1,               1,                  1,                 2019,            2021,                 'Terlaksana, mundur', 2027,                 'Sudah',            31,             'Selesai 26-28 Sep 2022', E'Amandemen ke IV\n*** G&G berupa studi regional (integrated basin study), field work',  'Studi Regional ST, KTI, PM, SL, dan JB', NULL,                 NULL),
(2,'Yes','Yes',42,17,'PT PERTAMINA HULU ENERGI JAMBI MERANG',367,'2019-02-10',0,6,54,369,1,1,4000000,4000000,1,1,1,2019,2021,'Terlaksana, mundur',2027,'Sudah',35,'Selesai 2 Sep 2022','Amandemen ke IV','FTG Bird''s Head - Papua Barat',NULL,NULL),
(2,'Yes','Yes',42,17,'PT PERTAMINA HULU ENERGI JAMBI MERANG',367,'2019-02-10',0,6,59,369,1,1,1000000,1000000,1,1,2,2020,2021,'Terlaksana, mundur',2027,'Sudah',31,'Selesai 14-16 Des 2022',E'Amandemen ke IV\n*** G&G berupa studi regional (integrated basin study), field work','Studi Regional North Sumatera Basin (NSB) & Sumatera Forearc Basin',NULL,NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
116,
369,
1,
1,
3000000,
3000000,
2,
2,
2,
2020,
2022,
'Terlaksana, mundur',
2027,
'Sudah',
31,
E'selesai 13 Des 2022\nselesai 27 Jan 2023',
E'Amandemen ke IV\n** Reprocessing Data Seismic 2D/3D dengan vintage sebelum tahun KKP Berjalan.\n**** Pembelian Seismic Reprocessing yang dihasilkan pada tahun berjalan KKP.',
E'- Pembelian Data Multi-Client Pseudo 3D Seismic Area South Makassar - North Bali Lombok seluas 270,000 Km2\n- 2D Seismic Reprocessing (PSTM & PSDM) Area Seram sepanjang 2,055 Km',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
55,
369,
1,
1,
5000000,
5000000,
1,
1,
2,
2020,
2021,
'Terlaksana, mundur',
2027,
'Sudah',
35,
'Selesai 2 Sep 2022',
'Amandemen ke IV',
'FTG Akimeugah- Papua',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
115,
369,
1,
1,
15000000,
15000000,
1,
1,
2,
2020,
2021,
'Terlaksana, mundur',
2027,
'Sudah',
33,
'Processing selesai Des 2022. P3 rencana Nov 2023.',
E'Amandemen ke IV\n* Perolehan data baru dari hasil akuisisi yang dilakukan pada tahun berjalan pelaksanaan KKP.',
'- Akuisisi dan Processing Seismik 2D 1,000 km VibroSeis Sub-Volcanic Jawa (realisasi 1,090 km)',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
114,
369,
1,
NULL,
60000000,
NULL,
2,
NULL,
2,
2020,
2025,
'Plan mundur',
2027,
'Belum',
33,
'Sebelumnya "Akuisisi dan Processing Seismik 2D Kepala Burung 800 km full fold" dialihkan areanya ke South Kutai Offshore dan South-East Java Forearc, rencana akuisisi di Q3 2025 sampai 2026.',
E'Amandemen ke IV\n* Perolehan data baru dari hasil akuisisi yang dilakukan pada tahun berjalan pelaksanaan KKP.',
E'- 3D Seismic Acquisition & Processing Offshore South Kutai 2,500 km2\n- 2D Seismic Acquisition & Processing Offshore South-East Java 6,000 km2',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
59,
369,
1,
1,
500000,
500000,
2,
2,
3,
2021,
2022,
'Terlaksana, mundur',
2027,
'Sudah',
31,
E'Selesai 24-25 Jan 2023\nSelesai 26-27 Jan 2023',
'Amandemen ke IV',
E'- Analisa Geokimia Rembesan Minyak dan Gas, Sampel Batuan Sumber di Sengkang-Bone Basin (sudah)\n- Survei Pemetaan Geologi & Prospektivitas Area Sumba (sudah)',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
116,
369,
1,
1,
2000000,
2000000,
3,
3,
3,
2021,
2023,
'Plan mundur',
2027,
'Sudah',
31,
E'Reprocessing 2D:\n- 6,686 km area North Sumatera dan Fore Arc\n- 1,850 km area Onshore Kutai\n- 4,873 km area Offshore Berau-West Papua',
E'Amandemen ke IV\n** Reprocessing Data Seismic 2D/3D dengan vintage sebelum tahun KKP Berjalan.\n***** Pembelian Seismic Reprocessing yang dihasilkan pada tahun berjalan KKP.',
E'Reprocessing 2D:\n- 6,686 km area North Sumatera dan Fore Arc,\n- 1,850 km area Onshore Kutai,\n- 4,873 km area Offshore Berau-West Papua',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
55,
369,
1,
1,
5000000,
5000000,
3,
3,
3,
2021,
2022,
'Terlaksana, mundur',
2027,
'Sudah',
35,
E'- Kutai-Barito: Kick Off Meeting 14 Oktober 2022. Selesai 100% (23,859.5 km2) pada 17 April 2023.\n- Mamberamo Teer: Sudah (2022-2023)\n- Modeling: sudah, belum presentasi final ke SKK Migas',
'Amandemen ke IV',
E'- Full Tensor / Airborne Gravity Gradiometry Kutai-Barito 23,859.5 km\n- Full Tensor / Airborne Gravity Gradiometry Mamberamo Teer 25,000 km\n- FTG & Magnetic Modeling (2024)',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
114,
369,
1,
1,
20000000,
20000000,
1,
1,
3,
2021,
2022,
'Terlaksana, mundur',
2027,
'Sudah',
33,
E'- Kick off meeting akan dilakukan pada tanggal 1 September 2022.\n- Selesai, belum P3',
'Amandemen ke IV',
'- Akuisisi dan Processing Seismik 2D Multizona Buton 645 km',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
114,
369,
1,
1,
20000000,
20000000,
2,
2,
3,
2021,
2023,
'Plan mundur',
2027,
'Sudah',
33,
E'- 3D Seismik Bone-Sengkang Offshore 821 km2: sudah\n- 2D Seismic Amalia Extension (WK Terbuka) 155 km: akuisisi sudah selesai, on going processing 95-100%',
'Amandemen ke IV',
E'- 3D Seismik Bone-Sengkang Offshore 821 km2\n- 2D Seismic Amalia Extension (WK Terbuka) 155 km',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
59,
369,
1,
1,
500000,
500000,
1,
1,
4,
2022,
2023,
'Terlaksana, mundur',
2027,
'Sudah',
31,
'- Kick Off Meeting 31 Maret 2023',
'Amandemen ke IV',
'- Integrated Regional G&G Area Kalimantan Utara',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
94,
369,
1,
NULL,
5415533,
NULL,
1,
NULL,
4,
2022,
2025,
'Plan mundur',
2027,
'Belum',
34,
'Proses inisiasi ke pihak TNI AL',
E'Amandemen ke IV\n******Anggaran berdasarkan perhitungan TNI AL',
'Survei Area Pengganti Daerah Latihan TNI AL',
NULL,
NULL),
(
2,
'Yes',
'Yes',
42,
17,
'PT PERTAMINA HULU ENERGI JAMBI MERANG',
367,
'2019-02-10',
0,
6,
59,
369,
1,
1,
500000,
500000,
1,
1,
5,
2023,
2023,
'Plan mundur',
2027,
'Sudah',
31,
NULL,
'Amandemen ke IV',
'Survey Geokimia Microseepage Offshore Bone-Sulawesi',
NULL,
NULL),
(
3,
'Yes',
'Yes',
8,
17,
'PT PERTAMINA HULU MAHAKAM',
367,
'2017-01-01',
4,
5,
185,
370,
1,
1,
400000,
400000,
1,
1,
1,
2017,
2018,
'Terlaksana, mundur',
2022,
'Reclass ke EPT',
31,
NULL,
'Sudah dilaksanakan',
'Reprocessing 3D CT3D & SNB3D',
NULL,
NULL),
(
3,
'Yes',
'Yes',
8,
17,
'PT PERTAMINA HULU MAHAKAM',
367,
'2017-01-01',
4,
5,
184,
370,
1,
1,
1000000,
1000000,
1,
1,
2,
2018,
2019,
'Terlaksana, mundur',
2022,
'Reclass ke EPT',
31,
NULL,
'Sudah dilaksanakan',
'Reprocessing 3D TN95, Greater Peciko dan Handil',
NULL,
NULL),
(
3,
'Yes',
'Yes',
8,
17,
'PT PERTAMINA HULU MAHAKAM',
367,
'2017-01-01',
4,
5,
186,
370,
1,
1,
800000,
800000,
1,
1,
2,
2018,
2021,
'Terlaksana, mundur',
2022,
'Reclass ke EPT',
31,
NULL,
'Sudah dilaksanakan',
'Reprocessing 3D South Mahakam',
NULL,
NULL),
(
3,
'Yes',
'Yes',
41,
17,
'PT PERTAMINA HULU ENERGI OGAN KOMERING',
367,
'2018-05-20',
12,
11,
169,
370,
1,
1,
500000,
500000,
1,
1,
1,
2018,
2019,
'Terlaksana, mundur',
2024,
'Reclass ke EPT',
29,
NULL,
'Sudah dilaksanakan',
'Re-entry & Perforation ASDJ-5',
NULL,
NULL),
(
1,
'No',
'Yes',
59,
13,
'PT MGA UTAMA ENERGI',
367,
'2023-01-12',
3,
2,
196,
370,
100,
NULL,
1700000,
NULL,
1,
NULL,
4,
2025,
2025,
'Plan ontime',
2027,
'Belum',
30,
'Seismik EPT',
'Pasal 4.2 akhir Thn ke-5 wajib menyetor sisa KP.',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
34,
4,
'CITIC SERAM ENERGY LIMITED',
367,
'2019-11-01',
5,
10,
129,
370,
217,
NULL,
18000000,
NULL,
1,
NULL,
3,
2021,
2024,
'Plan mundur',
2027,
'Reclass ke EPT',
30,
'WP&B 2025 masih masuk eksplorasi, namun kegiatan akan di-reclass ke eksploitasi karena Lofin telah PSE',
NULL,
'Seismik 3D Lofin 244.44 km2',
NULL,
NULL),
(
2,
'Yes',
'Yes',
34,
4,
'CITIC SERAM ENERGY LIMITED',
367,
'2019-11-01',
5,
10,
73,
370,
1,
NULL,
1000000,
0,
1,
0,
4,
2022,
2024,
'Plan mundur',
2027,
'Reclass ke EPT',
31,
NULL,
'Belum Dilaksanakan',
NULL,
NULL,
NULL),
(
3,
'No',
'Yes',
52,
5,
'PT EMP ENERGI GANDEWA',
367,
'2014-05-26',
9,
12,
242,
370,
1,
1,
500000,
500000,
1,
1,
1,
2014,
2015,
'Terlaksana, ontime',
2019,
'Sudah',
31,
'Studi Eksplorasi Tektonik/Struktur (Palinspatik), Play Sihapas, Pematang, Petani, dan Basement. P3 tanggal 11 Februari 2015.',
'Sudah Dilaksanakan',
'Studi Eksplorasi Tektonik/Struktur (Palinspatik), Play Sihapas, Pematang, Petani, dan Basement',
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
60,
370,
1,
NULL,
236000,
0,
1,
0,
1,
2022,
2022,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
31,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
215,
370,
100,
NULL,
4548000,
0,
1,
0,
2,
2023,
2023,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
30,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
60,
370,
1,
NULL,
256000,
0,
1,
0,
3,
2024,
2024,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
31,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
101,
370,
1,
NULL,
10169000,
0,
1,
0,
3,
2024,
2024,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
29,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
59,
370,
1,
NULL,
266000,
0,
1,
0,
4,
2025,
2025,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
31,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
101,
370,
1,
NULL,
12440000,
0,
1,
0,
4,
2025,
2025,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
29,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
59,
370,
1,
NULL,
277000,
0,
1,
0,
5,
2026,
2026,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
31,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL),
(
2,
'Yes',
'Yes',
22,
12,
'PT. MEDCO E&P TARAKAN',
367,
'2022-01-14',
4,
14,
101,
370,
1,
NULL,
7308000,
0,
1,
0,
5,
2026,
2026,
'Plan ontime',
2027,
'Perubahan KKP ke EPT',
29,
NULL,
'Perubahan KKP ke EPT',
NULL,
NULL,
NULL);
